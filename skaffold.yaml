apiVersion: skaffold/v4beta6
kind: Config
metadata:
  name: synthtext-automarket

# Build configuration
build:
  artifacts:
    - image: synthtext-n8n
      docker:
        dockerfile: Dockerfile
      sync:
        manual:
          - src: "src/**/*"
            dest: /app/src

# Deploy configuration
deploy:
  kubectl:
    defaultNamespace: synthtext

# Profiles for different environments
profiles:
  # Local development with live reload
  - name: dev
    activation:
      - command: dev
    build:
      artifacts:
        - image: synthtext-n8n
          docker:
            dockerfile: Dockerfile
            target: development
          sync:
            manual:
              - src: "src/**/*"
                dest: /app/src
    deploy:
      kubectl:
        defaultNamespace: default

  # Staging environment
  - name: staging
    activation:
      - command: build
    build:
      artifacts:
        - image: synthtext-n8n
          docker:
            dockerfile: Dockerfile
            target: production
    deploy:
      kubectl:
        defaultNamespace: synthtext-staging

  # Production environment
  - name: prod
    build:
      artifacts:
        - image: synthtext-n8n
          docker:
            dockerfile: Dockerfile
            target: production
    deploy:
      kubectl:
        defaultNamespace: synthtext-prod

# Portforward for local development
portForward:
  - resourceType: deployment
    resourceName: n8n
    port: 5678
    localPort: 5678
  - resourceType: service
    resourceName: postgres
    port: 5432
    localPort: 5432

# Note: Pre-pull n8n:latest before running skaffold

